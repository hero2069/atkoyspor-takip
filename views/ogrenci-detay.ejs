<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ã–ÄŸrenci Bilgi KartÄ± - AtkÃ¶y Spor Okulu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; font-family: Arial, sans-serif; }
    .card { border-top: 5px solid #D32F2F; border-radius: 10px; }
    .btn-danger { background-color: #D32F2F; }
    .btn-danger:hover { background-color: #B71C1C; }
    .form-group { margin-bottom: 15px; }
    .section-title {
      background: #D32F2F;
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      margin: 20px 0 15px;
    }
    .photo-upload {
      width: 150px;
      height: 150px;
      border: 2px dashed #ccc;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin: 10px 0;
      background: #f8f8f8;
      overflow: hidden;
    }
    .photo-upload img {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
  <form id="ogrenciForm" action="/ogrenci-kaydet" method="POST">
<body>
    <div class="container-fluid">
    <div class="row">
      <!-- Sol MenÃ¼ -->
      <div class="col-md-2 text-center p-3" style="background: #D32F2F; min-height: 100vh; color: white;">
        <img src="/images/atkÃ¶y.png" alt="Logo" class="img-fluid mb-3" style="max-width: 180px;">
        <hr>
        <a href="/dashboard" class="text-white text-decoration-none d-block p-2">Dashboard</a>
        <a href="/ogrenciler" class="text-white text-decoration-none d-block p-2">Ã–ÄŸrenciler</a>
        <a href="#" class="text-white text-decoration-none d-block p-2">Ekipman</a>
        <a href="#" class="text-white text-decoration-none d-block p-2">Analiz</a>
        <a href="#" class="text-white text-decoration-none d-block p-2">Takvim</a>
        <a href="#" class="text-white text-decoration-none d-block p-2">Ayarlar</a>
        <a href="/" class="btn btn-light btn-sm mt-4">Ã‡Ä±kÄ±ÅŸ Yap</a>
      </div>

      <!-- Ana Ä°Ã§erik -->
      <div class="col-md-10 p-4">
        <h3 class="text-danger">Ã–ÄŸrenci Bilgi KartÄ±</h3>
        <form id="ogrenciForm">

          <!-- Ã–ÄŸrenci Bilgileri -->
          <div class="section-title">Ã–ÄŸrenci Bilgileri</div>
          <div class="row">
            <div class="col-3 text-center">
              <div class="photo-upload" id="photoArea">
                <span>ðŸ“· FotoÄŸraf</span>
                <input type="file" id="foto" accept="image/*" style="display: none;">
              </div>
              <small>YÃ¼klemek iÃ§in tÄ±kla</small>
            </div>

            <div class="col-9">
              <div class="row">
                <div class="col-6">
                  <div class="form-group">
                    <label>TC Kimlik No</label>
                    <input type="text" id="tc" name="tc" class="form-control" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value.length === 11) validateTC(this.value);">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>AdÄ±</label>
                    <input type="text" id="ad" name="ad" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>SoyadÄ±</label>
                    <input type="text" id="soyad" name="soyad" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>DoÄŸum Tarihi</label>
                    <input type="date" id="dogumTarihi" name="dogumTarihi" class="form-control">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>DoÄŸum Yeri</label>
                    <input type="text" id="dogumYeri" name="dogumYeri" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>Boy (m)</label>
                    <select id="boy" name="boy" class="form-control">
                      <option></option>
                      <!-- 1.00 - 1.90 arasÄ± seÃ§enekler -->
                      <script>
                        for (let i = 100; i <= 190; i++) {
                          const boy = (i / 100).toFixed(2);
                          document.write(`<option value="${boy}">${boy}</option>`);
                        }
                      </script>
                    </select>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>Kilo (kg)</label>
                    <select id="kilo" name="kilo" class="form-control">
                      <option></option>
                      <script>
                        for (let i = 20; i <= 80; i++) {
                          document.write(`<option value="${i}">${i}</option>`);
                        }
                      </script>
                    </select>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>Kan Grubu</label>
                    <select id="kanGrubu" name="kanGrubu" class="form-control">
                      <option></option>
                      <option>A+</option>
                      <option>A-</option>
                      <option>B+</option>
                      <option>B-</option>
                      <option>0+</option>
                      <option>0-</option>
                      <option>AB+</option>
                      <option>AB-</option>
                    </select>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>Spor BranÅŸÄ±</label>
                    <select id="brans" name="brans" class="form-control">
                      <option></option>
                      <option>Futbol</option>
                      <option>Basketbol</option>
                      <option>Voleybol</option>
                      <option>AtÄ±cÄ±lÄ±k</option>
                      <option>Tenis</option>
                    </select>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>Telefon</label>
                    <input type="text" id="telefon" name="telefon" class="form-control" placeholder="555 555 55 55" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label>Okulu</label>
                    <input type="text" id="okul" name="okul" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-z0-9Ã‡cÃ–Ã¶ÃœuIÅžs .-]/g, '')">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Veli Bilgileri -->
          <div class="section-title">Ã–ÄŸrenci Veli Bilgileri</div>
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label>Baba AdÄ±</label>
                <input type="text" id="babaAd" name="babaAd" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label>Baba SoyadÄ±</label>
                <input type="text" id="babaSoyad" name="babaSoyad" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label>Baba Telefon</label>
                <input type="text" id="babaTel" name="babaTel" class="form-control" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label>Baba MesleÄŸi</label>
                <input type="text" id="babaMeslek" name="babaMeslek" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>

            <div class="col-6">
              <div class="form-group">
                <label>Anne AdÄ±</label>
                <input type="text" id="anneAd" name="anneAd" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label>Anne SoyadÄ±</label>
                <input type="text" id="anneSoyad" name="anneSoyad" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label>Anne Telefon</label>
                <input type="text" id="anneTel" name="anneTel" class="form-control" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label>Anne MesleÄŸi</label>
                <input type="text" id="anneMeslek" name="anneMeslek" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>

            <div class="col-12">
              <div class="form-group">
                <label>Ev Adresi</label>
                <textarea id="adres" name="adres" class="form-control" rows="3"></textarea>
              </div>
            </div>
          </div>

          <!-- Acil Ä°letiÅŸim -->
          <div class="section-title">Acil Durumda UlaÅŸÄ±labilecek KiÅŸi</div>
          <div class="row">
            <div class="col-4">
              <div class="form-group">
                <label>AdÄ±</label>
                <input type="text" id="acilAd" name="acilAd" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>
            <div class="col-4">
              <div class="form-group">
                <label>SoyadÄ±</label>
                <input type="text" id="acilSoyad" name="acilSoyad" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>
            <div class="col-4">
              <div class="form-group">
                <label>YakÄ±nlÄ±k Derecesi</label>
                <input type="text" id="acilYakinlik" name="acilYakinlik" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-zÃ‡cÃ–Ã¶ÃœuIÅžs ]/g, '')">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label>Telefon</label>
                <input type="text" id="acilTel" name="acilTel" class="form-control" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
              </div>
            </div>
          </div>

          <!-- Aidat Takibi -->
          <div class="section-title">Aidat Takibi</div>
          <div class="row mb-4" id="aidatBlok">
            <!-- Dinamik olarak JS ile doldurulacak -->
          </div>

          <!-- Butonlar -->
          <div class="text-end mt-4">
            <button type="button" class="btn btn-secondary" onclick="window.location.href='/ogrenciler'">Geri</button>
            <button type="button" class="btn btn-danger" onclick="ciktiAl()">Ã‡Ä±ktÄ± Al</button>
            <button type="submit" class="btn btn-success">Kaydet</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ExcelJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    // TC Kimlik No doÄŸrulama (11 hane + algoritma)
    function validateTC(tc) {
      if (tc.length !== 11) return false;
      const digits = tc.split('').map(Number);
      const checksum = digits[10];
      const rule1 = (digits[0]+digits[2]+digits[4]+digits[6]+digits[8]) * 7 + (digits[1]+digits[3]+digits[5]+digits[7]) * 9;
      const rule2 = (digits[0]+digits[2]+digits[4]+digits[6]+digits[8]) % 10;
      const rule3 = (rule1 + digits[9]) % 10;
      return (rule2 === digits[9]) && (rule3 === checksum);
    }

    // FotoÄŸraf yÃ¼kleme
    document.getElementById('photoArea').onclick = () => document.getElementById('foto').click();
    document.getElementById('foto').onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          document.getElementById('photoArea').innerHTML = `<img src="${event.target.result}">`;
        };
        reader.readAsDataURL(file);
      }
    };

    // Aidat takibi (Ã¶rnek: son 6 ay)
    const aidatBlok = document.getElementById('aidatBlok');
    const aylar = ['Ocak', 'Åžubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran'];
    const tarih = new Date();
    const yil = tarih.getFullYear();

    aylar.forEach((ay, i) => {
      const odendi = Math.random() > 0.3; // Ã¶rnek veri
      aidatBlok.innerHTML += `
        <div class="col-2">
          <strong>${ay}</strong><br>
          <small>${yil}</small><br>
          <button class="btn btn-sm ${odendi ? 'btn-success' : 'btn-danger'} mt-2">
            ${odendi ? 'Ã–dendi' : 'Ã–denmedi'}
          </button>
        </div>
      `;
    });

    // Ã‡Ä±ktÄ± Al (Excel)
    async function ciktiAl() {
      const tc = document.getElementById("tc").value;
      const ad = document.getElementById("ad").value;
      const soyad = document.getElementById("soyad").value;
      const adsoyad = `${ad} ${soyad}`;
      const dogumTarihi = document.getElementById("dogumTarihi").value;
      const dogumYeri = document.getElementById("dogumYeri").value;
      const boy = document.getElementById("boy").value;
      const kilo = document.getElementById("kilo").value;
      const kanGrubu = document.getElementById("kanGrubu").value;
      const brans = document.getElementById("brans").value;
      const telefon = document.getElementById("telefon").value;
      const okul = document.getElementById("okul").value;

      const babaAd = document.getElementById("babaAd").value;
      const babaTel = document.getElementById("babaTel").value;
      const anneAd = document.getElementById("anneAd").value;
      const anneTel = document.getElementById("anneTel").value;
      const adres = document.getElementById("adres").value;

      const acilAd = document.getElementById("acilAd").value;
      const acilYakinlik = document.getElementById("acilYakinlik").value;
      const acilTel = document.getElementById("acilTel").value;

      // Tarih formatÄ±: dd/mm/yyyy
      const tarih = new Date(dogumTarihi);
      const tarihStr = tarih.getDate().toString().padStart(2, '0') + '/' + 
                       (tarih.getMonth() + 1).toString().padStart(2, '0') + '/' + 
                       tarih.getFullYear();

      try {
        const response = await fetch('https://raw.githubusercontent.com/hero2069/atkoy-spor-okulu/main/templates/atk%C3%B6y.xls');
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];

        // HÃ¼crelere yaz
        worksheet['B6'] = { t: 's', v: tc };
        worksheet['B8'] = { t: 's', v: adsoyad };
        worksheet['B10'] = { t: 's', v: dogumYeri + ', ' + tarihStr };
        worksheet['J6'] = { t: 'n', v: parseFloat(boy) };
        worksheet['J8'] = { t: 'n', v: parseInt(kilo) };
        worksheet['J10'] = { t: 's', v: kanGrubu };
        worksheet['B12'] = { t: 's', v: okul };
        worksheet['J12'] = { t: 's', v: telefon };

        worksheet['B17'] = { t: 's', v: babaAd };
        worksheet['I17'] = { t: 's', v: babaTel };
        worksheet['B19'] = { t: 's', v: anneAd };
        worksheet['I19'] = { t: 's', v: anneTel };
        worksheet['B20'] = { t: 's', v: adres };

        worksheet['B27'] = { t: 's', v: acilYakinlik };
        worksheet['I27'] = { t: 's', v: acilTel };
        worksheet['B28'] = { t: 's', v: acilAd };

        worksheet['A33'] = { t: 's', v: `Velisi bulunduÄŸumuz ${tarihStr} DoÄŸum tarihli ${adsoyad} AtkÃ¶yspor KulÃ¼bÃ¼ AltyapÄ±sÄ±na kaydÄ±nÄ±n yapÄ±lmasÄ±nÄ± rica ederim.` };
        worksheet['A35'] = { t: 's', v: `YukarÄ±da aÃ§Ä±k kimliÄŸi yazÄ±lÄ± bulunan ${adsoyad} AtkÃ¶yspor KulÃ¼bÃ¼ AltyapÄ±sÄ±nda yarÄ±ÅŸmacÄ± olarak, antrenmanlara, mÃ¼sabakalara katÄ±lmasÄ±na muvafakat ederim.` };

        worksheet['B51'] = { t: 's', v: 'Admin' }; // kaydÄ± yapan
        worksheet['I51'] = { t: 's', v: '8-17 YaÅŸ' }; // yaÅŸ grubu

        // Excel'i indir
        const blob = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        const excelBlob = new Blob([blob], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        saveAs(excelBlob, `${adsoyad}_kayÄ±t_formu.xlsx`);
      } catch (err) {
        alert('Excel ÅŸablonu yÃ¼klenemedi. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin.\nHata: ' + err.message);
      }
    }

    // Form gÃ¶nderimi (geÃ§ici)
    document.getElementById('ogrenciForm').onsubmit = (e) => {
      e.preventDefault();
      alert('Ã–ÄŸrenci bilgileri kaydedildi!');
    };
  </script>
</body>
</html>
